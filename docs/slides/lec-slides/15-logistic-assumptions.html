<!DOCTYPE html>
<html>
  <head>
    <title>Logistic regression</title>
    <meta charset="utf-8">
    <meta name="author" content="Dr. Maria Tackett" />
    <link rel="stylesheet" href="sta210-slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Logistic regression
## Model fit &amp; Assumptions
### Dr. Maria Tackett
### 03.18.19

---





### Announcements

- HW 05 due Mon, Mar 25 at 11:59p



---

### Packages


```r
library(tidyverse)
library(knitr)
library(broom)
library(NHANES)
library(pROC) #ROC curves
library(questionr)
```

---

 

### Review

- `\(Y\)`: binary response
  + 1: yes
  + 0: no
  
- `\(Mean(Y) = p\)`

- `\(Var(Y) = p(1-p)\)`

- **Odds of "yes"**: `\(\omega = \frac{p}{1-p}\)`

---

 

### Comparing Odds

Suppose we have two independent groups with odds `\(\omega_1\)` and `\(\omega_2\)`

- &lt;font class="vocab3"&gt;Odds Ratio:&lt;/font&gt; `\(\phi = \frac{\omega_1}{\omega_2}\)`

- Use inference to assess if groups have equal odds, i.e. `\(\phi = 1\)`
  + &lt;font class="vocab3"&gt;Hypothesis Test:&lt;/font&gt; `$$H_0: \log(\phi) = 0$$`
  + &lt;font class="vocab3"&gt;Confidence Interval:&lt;/font&gt;
  
  `$$\exp\Big\{\log(\phi) \pm z^* SE(\log(\phi))\Big\}$$`

---

 

### NHANES Data

- &lt;a  href="https://www.cdc.gov/nchs/nhanes/index.htm" target="_blank"&gt;National Health and Nutrition Examination Survey&lt;/a&gt; is conducted by the National Center for Health Statistics (NCHS) 

- The goal is to *"assess the health and nutritional status of adults and children in the United States"*

- This survey includes an interview and a physical examination

---

 

### NHANES Data

- We will use the data from the &lt;font class="vocab"&gt;`NHANES`&lt;/font&gt; R package

- Contains 75 variables for the 2009 - 2010 and 2011 - 2012 sample years

- The data in this package is modified for educational purposes and should **not** be used for research

- Original data can be obtained from the &lt;a href="https://www.cdc.gov/nchs/data_access/index.htm" target="_blank"&gt;NCHS website&lt;/a&gt; for research purposes

- Type &lt;font class="vocab"&gt;`?NHANES`&lt;/font&gt; in console to see list of variables and definitions

---

 

### NHANES: Physical Activity &amp; Sleep

- Do people who do regular physical activity have lower odds of sleep problems than those who do not do regular physical activity?

- We will analyze the following variables: 
  + &lt;font class="vocab"&gt;`PhysActive`: &lt;/font&gt;Participant does moderate to vigorous-intensity sports, fitness or recreational activities
  
  + &lt;font class="vocab"&gt;`SleepTrouble`: &lt;/font&gt;Participant has told doctor or other health professional they had trouble sleeping
  
---

 

### NHANES: Physical Activity &amp; Sleep


```r
# Filter data to only include adults with all data for pulse 
set.seed(1234)
nhanes &lt;- NHANES %&gt;% filter(Age &gt; 18, !is.na(Pulse)) %&gt;% 
  sample_n(500)
nhanes %&gt;% select(Age,Gender,PhysActive,SleepTrouble) %&gt;% glimpse()
```

```
## Observations: 500
## Variables: 4
## $ Age          &lt;int&gt; 59, 32, 24, 29, 58, 62, 80, 30, 52, 44, 57, 32, 54,…
## $ Gender       &lt;fct&gt; male, female, female, male, female, male, male, mal…
## $ PhysActive   &lt;fct&gt; No, No, No, No, Yes, No, No, Yes, Yes, No, No, No, …
## $ SleepTrouble &lt;fct&gt; Yes, No, Yes, No, No, No, No, No, No, Yes, No, No, …
```
---

 

### NHANES: Physical Activity &amp; Sleep


```r
#get counts for each combination of PhysActive and SleepTrouble
table &lt;- nhanes %&gt;% group_by(PhysActive,SleepTrouble) %&gt;% summarise(n=n())
kable(table,format="html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; PhysActive &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; SleepTrouble &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; n &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; No &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; No &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 161 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; No &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Yes &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 75 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Yes &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; No &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 189 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Yes &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Yes &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 75 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;







---

 

### NHANES: Physical Activity &amp; Sleep

- **Group 1: PhysActive="Yes", Group 2: PhysActive="No"**
  + `\(\hat{\omega}_1\)`: 0.3968
  + `\(\hat{\omega}_2\)`: 0.4658
  + `\(\hat{\phi}\)`: 0.8519
  + `\(SE(\log(\hat{\phi}))\)` = 0.1954
  + `\(SE_0(\log(\hat{\phi}))\)` = 0.1955


- Is there evidence that people who do regular physical activity have lower odds of sleep problems than those who do not do regular physical activity?
- Calculate a 95% confidence interval for the odds ratio.

---

 

### NHANES: Physical Activity &amp; Sleep

- R has a functions to calculate the odds ratio 

- &lt;font class="vocab"&gt;`odds.ratio()`&lt;/font&gt; function in the `questionr` package is shown below


```r
#calculate odds ratio and 95% confidence interval
model &lt;- glm(SleepTrouble ~ PhysActive, family=binomial, data=nhanes)
or &lt;- odds.ratio(model,level=0.95)
kable(or,format="html",digits=3)
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; OR &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 2.5 % &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 97.5 % &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.466 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.352 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.61 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; PhysActiveYes &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.852 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.580 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.412 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

class: middle, center

&lt;font class="vocab3"&gt;We want to build a model to incorporate more variables that could potentially explain the odds of having sleep problems.&lt;/font&gt;

---


 

### Linear model? 

- We want to use a model to predict a binary response `\(Y\)`

--

- Suppose we use a linear regression model to predict `\(Y\)` using some explanatory variable `\(X\)`

`$$Y_i = \beta_0 + \beta_1X_{i} + \epsilon_i \hspace{10mm} \epsilon_i \sim N(0,\sigma^2)$$`

--

- This model assumes that `\(Y\)` could be any continuous value; however, it can only be 0 or 1

--

- So linear regression is not appropriate

---

 

### Other model choices

Let `\(P(Y_i=1|X_i) = p_i\)` and `\(P(Y_i=0|X_i) = 1-p_i\)`
&lt;br&gt; 
&lt;br&gt; 

--

Potential models for `\(p_i\)`: 
&lt;br&gt;

--

- **&lt;font class="vocab"&gt;Linear:&lt;/font&gt;** `\(p_i = \beta_0 + \beta_1 X_i\)`
  + `\(p_i\)` possibly outside of `\((0,1)\)`
--

- **&lt;font class="vocab"&gt;Log-linear:&lt;/font&gt;** `\(\log(p_i) =\beta_0 + \beta_1 X_i\)`
  + `\(p_i\)` possibly greater than 1

---

 

### Logistic Regression Model 

- Suppose `\(P(Y_i=1|X_i) = p_i\)` and `\(P(Y_i=0|X_i) = 1-p_i\)`

- The &lt;font class="vocab3"&gt;logistic regression model &lt;/font&gt; is

`$$\log\Big(\frac{p_i}{1-p_i}\Big) = \beta_0 + \beta_1 X_i$$`
&lt;br&gt; 


- `\(\log\Big(\frac{p_i}{1-p_i}\Big)\)` is called the &lt;font class="vocab3"&gt;logit&lt;/font&gt; function


---

 

### Logistic Regression Model 

`$$\log\Big(\frac{p_i}{1-p_i}\Big) = \beta_0 + \beta_1 X_i$$`
&lt;br&gt; 
&lt;br&gt; 

- We can calculate `\(p_i\)` by solving the logit equation: 

`$$p_i = \frac{\exp\{\beta_0 + \beta_1 X_i\}}{1 + \exp\{\beta_0 + \beta_1 X_i\}}$$`

---

 

### Solving Logit Equation 

`$$\begin{aligned}&amp;\log\Big(\frac{p_i}{1-p_i}\Big) = \beta_0 + \beta_1 X_i\\
\Rightarrow \hspace{8mm} &amp;\exp\bigg\{\log\Big(\frac{p_i}{1-p_i}\Big)\bigg\} = \exp\{\beta_0 + \beta_1 X_i\}\\
\Rightarrow \hspace{8mm} &amp; \frac{p_i}{1-p_i} = \exp\{\beta_0 + \beta_1 X_i\} \\
\Rightarrow \hspace{8mm}&amp;p_i = \frac{\exp\{\beta_0 + \beta_1 X_i\}}{1+\exp\{\beta_0 + \beta_1 X_i\}}\\\end{aligned}$$`

---

 

### Interpreting Model Coefficients

`$$\log\Big(\frac{p_i}{1-p_i}\Big) = \beta_0 + \beta_1 X_i$$`

--

- &lt;font class="vocab"&gt;Slope, `\(\beta_1\)`: &lt;/font&gt;
  + As `\(X_i\)` increases by 1 unit, log-odds of `\(Y\)` increases by `\(\beta_1\)`
  + As `\(X_i\)` increases by 1 unit, the odds of `\(Y\)` multiply by a factor of `\(\exp\{\beta_1\}\)`

---

 

### Interpreting Model Coefficients

`$$\log\Big(\frac{p_i}{1-p_i}\Big) = \beta_0 + \beta_1 X_i$$`

--

- &lt;font class="vocab"&gt;Intercept, `\(\beta_0\)`: &lt;/font&gt;
  + When `\(X=0\)`, log-odds of `\(Y\)` are `\(\beta_0\)`
  + When `\(X=0\)`, odds of `\(Y\)` are `\(\exp\{\beta_0\}\)`
  + If we mean-center `\(X\)`, then we can interpret the intercept in terms of the mean of `\(X\)`
--

- Can interpret results by graphing predicted `\(p\)` for values of `\(X\)`

---

 

### Estimating the Coefficients

- Estimate coefficients using *maximum likelihood estimation*
  + covered in STA 250 and STA 360
--

- &lt;font class="vocab"&gt;Basic Idea: &lt;/font&gt;
  + Find values of `\(\beta_0\)` and `\(\beta_1\)` that make observed values of `\(Y\)` the most likely to have occurred
  + Use multivariable calculus and numerical methods to estimate coefficients
--

- We will use R to estimate the coefficients

---

 

### Inference for Coefficients

- &lt;font class="vocab3"&gt;standard error, `\(SE(\hat{\beta}_1)\)`: &lt;/font&gt;estimated standard deviation of the sampling distribution of `\(\hat{\beta}_1\)`

- We can calculate the `\(\color{blue}{100(1-\alpha)\%}\)` &lt;font color="blue"&gt;confidence interval&lt;/font&gt; based on the large-sample Normal approximations
  + **CI for `\(\boldsymbol{\beta}_1\)`**: `$$\hat{\beta}_1 \pm z^* SE(\beta_1)$$`
  + **CI for `\(\exp\{\boldsymbol{\beta}_1\}\)`**: `$$\exp\{\hat{\beta}_1 \pm z^* SE(\beta_1)\}$$`

---

 

### Logistic Regression in R

- Use the &lt;font class="vocab"&gt;`glm()`&lt;/font&gt; function in R 

- Set &lt;font class="vocab"&gt;`family=binomial`&lt;/font&gt;


```r
my.model &lt;- glm(Y ~ X, family=binomial,data=my.data)
```

---

 

### NHANES: Pulse Rate &amp; Sleep

- **Can pulse rate be used to distinguish the odds of an adult having trouble sleeping?**

- &lt;font class="vocab"&gt;`Pulse`&lt;/font&gt;: 60 second pulse rate



```r
#caluclate logistic model using mean-centered Pulse
nhanes &lt;- nhanes %&gt;% mutate(pulse.cent = Pulse - mean(Pulse))
log.odds &lt;- glm(SleepTrouble ~ pulse.cent, family=binomial,data=nhanes)
kable(tidy(log.odds),format="html",digits=3)
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; term &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; estimate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; std.error &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; statistic &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p.value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.854 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.098 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -8.697 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; pulse.cent &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.016 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.008 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.948 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.051 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

 

### NHANES: Pulse Rate &amp; Sleep
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; term &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; estimate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; std.error &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; statistic &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p.value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.854 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.098 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -8.697 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; pulse.cent &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.016 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.008 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.948 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.051 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;




- &lt;font class="vocab"&gt;Slope: &lt;/font&gt; As pulse rate increases by 1 beat per minute, the odds of having sleep trouble are expected to multiply by a factor of 1.02, with 95% confidence interval 1 to 1.032

--

- &lt;font class="vocab"&gt;Intercept: &lt;/font&gt; A person with an average pulse (72.452 beats per minute) is expected to have 0.43 to 1 odds of having sleep trouble, with 95% confidence interval 0.35 to 0.515

---

 

### NHANES: Computers &amp; Sleep

- &lt;font class="vocab"&gt;`CompHrsDay`: &lt;/font&gt; Number of hours per day on average participant used a computer or gaming device over the last 30 days. 
  + 0_hrs
  + 0_to_1_hr
  + 1_hr
  + 2_hr
  + 3_hr
  + 4_hr
  + More_4_hr
- &lt;font class="vocab"&gt;`Age`: &lt;/font&gt; Age at time of screening (in years). Participants 80 or older were recorded as 80.

---

 

### NHANES: Computers &amp; Sleep

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; term &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; estimate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; std.error &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; statistic &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p.value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -2.168 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.594 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -3.648 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CompHrsDay0_to_1_hr &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.284 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.382 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.745 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.456 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CompHrsDay1_hr &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.436 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.419 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.040 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.298 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CompHrsDay2_hr &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.412 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.530 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.776 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.438 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CompHrsDay3_hr &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.331 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.650 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.047 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.041 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CompHrsDay4_hr &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.803 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.990 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.822 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.068 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CompHrsDayMore_4_hr &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.318 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.626 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.508 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.611 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Age &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.024 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.009 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.590 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.010 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


- Describe the relationship between the amount of time spent on a computer and the odds of having trouble sleeping after adjusting for age.

---



### Assumptions &amp; Model Fit

- &lt;font class="vocab"&gt;Assumptions&lt;/font&gt;
  + Independence of residuals
  + Log-odds has linear relationship with explanatory variables
  + No significant impacts due to influential points or multicollinearity (when there are multiple explanatory variables)
--

- Not effective to examine the residuals
  + Residual positive when `\(Y=1\)` and negative when `\(Y=0\)`
  + Constant variance not an assumption of logistic regression
  + Normality of residuals not an assumption of logistic regression

---



### Assumptions &amp; Model Fit

- &lt;font class="vocab"&gt;Check Assumptions&lt;/font&gt;
  + Plot of binned residuals vs. predicted values
  + Plot of binned residuals vs. numeric explanatory variables
  + Leverage, Cook's distance, and multicollinearity (if more than one explanatory variable)
--

- &lt;font class="vocab"&gt;Check Model Fit&lt;/font&gt;
  + Examine ROC curve
  + Examine confusion matrix

---



### Binned Residuals

To examine binned residuals...

- Calculate raw residuals
- Order observations either by the values of the predicted probabilities or by the numeric explanatory variable itself
- Use the ordered data to create *g* bins of approximately equal size
  + Default value: `\(g = \sqrt{n}\)`
- Calculate average residual value in each bin
- Plot average residuals vs. average predicted probability (or average explanatory variable)

--

Can use the &lt;font class="vocab"&gt;`arm`&lt;/font&gt; package in R

---



### Binned Residuals

- Look for patterns

- Nonlinear trend may be indication that squared term or log transformation of explanatory variable required

- If bins have average residuals with large magnitude
  + Look at averages of other explanatory variables across bins
  + Interaction may be required if large residuals correspond to certain combinations of explanatory variables
  
---

 

### Raw Residuals: Pulse &amp; Sleep


```r
nhanes &lt;- nhanes %&gt;%
  mutate(Residuals = residuals.glm(log.odds,type="response"), 
         Predicted = predict.glm(log.odds,type="response"))
```

&lt;img src="15-logistic-assumptions_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" /&gt;
---

 

### Binned Residuals - Pulse &amp; Sleep

```r
library(arm)
binnedplot(x=nhanes$Predicted,y=nhanes$Residuals,xlab="Predicted Probabilities")
```

&lt;img src="15-logistic-assumptions_files/figure-html/unnamed-chunk-15-1.png" style="display: block; margin: auto;" /&gt;

---

 

### Binned Residuals - Pulse &amp; Sleep


```r
library(arm)
binnedplot(x=nhanes$Pulse,y=nhanes$Residuals,xlab="Pulse")
```

&lt;img src="15-logistic-assumptions_files/figure-html/unnamed-chunk-16-1.png" style="display: block; margin: auto;" /&gt;
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
