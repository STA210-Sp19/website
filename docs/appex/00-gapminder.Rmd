---
title: "Gapminder Data"
author: "Dr. Maria Tackett"
date: "01.09.19"
output: html_document
---

**CHANGE INTRO**
Let's take a look at the voting history of countries in the United Nations General Assembly. We will be using data from the unvotes package. Additionally, we will make use of the tidyverse and lubridate packages.

```{r load-packages, warning=FALSE, message=FALSE}
library(dslabs)
library(tidyverse)
library(lubridate)
library(DT)
```

## Data

The `gapminder` data set contains the health and income outcomes for 184 countries from the years 1960 to 2016. For this analysis, we will use the following variables: 

- `year`: 1960 - 2016
- `country`: See [Appendix](#appendix) for a list of countries.
- `continent`
- `population`
- `gdp`: Gross domestic project according to the World Bank.

```{r view-gapminder}
gapminder
```

## Analysis

```{r}
glimpse(movielens)


```

We begin by looking at how the population of each country has changed over time. Since we want to visualize the results, we will choose a few countries of interest for the analysis. 

```{r country-list}
country_list <- c("United States", "Iceland", "Japan", "Mexico")
```

```{r plot-yearly-yes, fig.width=10, warning=FALSE}
gapminder %>%
  filter(country %in% country_list) %>% 
  mutate(population_prev = lag(population,1)) %>%
  summarize(change = population - population_prev) %>%
  ggplot(mapping = aes(x = year, y = change, color = country)) +
    geom_line() 
    #ylab("% of votes that are 'Yes'")
```

Next, let's see how US and Turkey's voting record changed over the years on each of the issues.

```{r plot-yearly-yes-issue, fig.width=10, warning=FALSE}
un_votes %>%
  filter(country %in% c("United States of America", "Turkey")) %>%
  inner_join(un_roll_calls, by = "rcid") %>%
  inner_join(un_roll_call_issues, by = "rcid") %>%
  group_by(country, year = year(date), issue) %>%
  summarize(votes = n(),
            percent_yes = mean(vote == "yes")) %>%
  filter(votes > 5) %>%  # Only use records where there are more than 5 votes
  ggplot(mapping = aes(x = year, y = percent_yes, color = country)) +
    geom_point() +
    geom_smooth(method = "loess", se = FALSE) +
    facet_wrap(~ issue)
```

## References

1. David Robinson (2017). unvotes: United Nations General Assembly Voting Data. R package version 0.2.0. https://CRAN.R-project.org/package=unvotes.
2. Erik Voeten "Data and Analyses of Voting in the UN General Assembly" Routledge Handbook of International Organization, edited by Bob Reinalda (published May 27, 2013).
3. Much of the analysis has been modeled on the examples presented in the [unvotes package vignette](https://cran.r-project.org/web/packages/unvotes/vignettes/unvotes.html).

## Appendix

Below is a list of countries in the dataset:

```{r}
un_votes %>% 
  arrange(country) %>% 
  select(country) %>%
  distinct() %>%
  datatable()
```
